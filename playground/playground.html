<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>2D Mesh Plotter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.0.0/math.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.18.1.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #2d2d2d; /* Dark background for the entire page */
            color: white;
        }
        #controls {
            margin-bottom: 20px;
        }
        label {
            margin-right: 10px;
        }
        input, select {
            margin-right: 10px;
        }
    </style>
</head>
<body>
<h1>2D Mesh Plotter</h1>
<div id="controls">
    <label for="cellSize">Cell Size (mm):</label>
    <input type="number" id="cellSize" value="10" step="1" min="1">

    <label for="meshWidth">Mesh Width (mm):</label>
    <input type="number" id="meshWidth" value="20" step="10" min="10" max="500">

    <label for="meshHeight">Mesh Height (mm):</label>
    <input type="number" id="meshHeight" value="20" step="10" min="10" max="300">

    <label for="latticeType">Lattice Type:</label>
    <select id="latticeType">
        <option value="square">Square</option>
        <option value="checkerboard">Checkerboard</option>
    </select>

    <label for="lineWidths">Line Widths (comma-separated):</label>
    <input type="text" id="lineWidths" value="2, 3, 4, 5" placeholder="e.g., 2, 3, 4, 5">
</div>

<div id="mesh-output"></div>
<div id="mesh-plot"></div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const viewer = new Viewer();
        viewer.initialize(); // Initialize the viewer
    });

    // Mesh Class to store points and connections
    class Mesh {
        constructor(cellSize, meshWidth, meshHeight, latticeType) {
            this.cellSize = cellSize;
            this.meshWidth = meshWidth;
            this.meshHeight = meshHeight;
            this.latticeType = latticeType;
            this.points = [];
            this.connections = [];
            this.generateMeshData();
        }

        generateMeshData() {
            const n_nodes_x = Math.floor(this.meshWidth / this.cellSize);
            const n_nodes_z = Math.floor(this.meshHeight / this.cellSize);

            // Generate points
            for (let z = 0; z <= n_nodes_z; z++) {
                for (let x = 0; x <= n_nodes_x; x++) {
                    this.points.push([x * this.cellSize, z * this.cellSize]); // Coordinates in mm
                }
            }

            // Generate connections based on lattice type
            for (let i = 0; i < n_nodes_z; i++) {
                for (let j = 0; j < n_nodes_x; j++) {
                    const n1 = i * (n_nodes_x + 1) + j;
                    const n2 = n1 + 1;
                    const n3 = n1 + (n_nodes_x + 1);
                    const n4 = n3 + 1;

                    if (this.latticeType === "square") {
                        this.addConnection(n1, n3);
                        this.addConnection(n2, n4);
                        this.addConnection(n3, n4);
                    } else if (this.latticeType === "checkerboard") {
                        if ((i + j) % 2 === 0) {
                            this.addConnection(n1, n4); // Cross-diagonal line
                        } else {
                            this.addConnection(n2, n3); // Opposite-diagonal line
                        }
                        this.addConnection(n1, n3);
                        this.addConnection(n2, n4);
                        this.addConnection(n3, n4);
                    }
                }
            }
        }

        addConnection(start, end) {
            this.connections.push([start, end]);
        }

        getPoints() {
            return this.points;
        }

        getConnections() {
            return this.connections;
        }
    }

    // Drawer Class to interact with HTML and draw the Mesh using Plotly
    class Drawer {
        constructor(mesh, lineWidths) {
            this.mesh = mesh;
            this.lineWidths = lineWidths;
        }

        plot() {
            const coords = this.mesh.getPoints();
            const connections = this.mesh.getConnections();
            let lines = { x: [], y: [], mode: 'lines', type: 'scatter', line: { color: 'blue', width: [] } };

            // Add lines for connections with specified widths
            connections.forEach(([start, end], index) => {
                lines.x.push(coords[start][0], coords[end][0], null);
                lines.y.push(coords[start][1], coords[end][1], null);
                // Assign variable widths based on the input widths
                lines.line.width.push(this.lineWidths[index % this.lineWidths.length]);
            });

            // Plot using Plotly
            let data = [
                {
                    x: coords.map(coord => coord[0]),
                    y: coords.map(coord => coord[1]),
                    mode: 'markers',
                    type: 'scatter',
                    marker: { color: 'red', size: 4 }
                },
                lines
            ];

            let layout = {
                title: 'Generated Mesh',
                autosize: true,
                plot_bgcolor: "#1e1e1e", // Dark background for the plot
                paper_bgcolor: "#1e1e1e", // Dark background for the plot area
                font: { color: 'white' },
                xaxis: {
                    title: 'X (mm)',
                    range: [0, this.mesh.meshWidth],
                    showgrid: true,
                    gridcolor: '#444',
                    tickformat: ".0f" // Set tick format to show as integer in mm
                },
                yaxis: {
                    title: 'Y (mm)',
                    range: [0, this.mesh.meshHeight],
                    scaleanchor: 'x',
                    scaleratio: 1,
                    showgrid: true,
                    gridcolor: '#444',
                    tickformat: ".0f", // Set tick format to show as integer in mm
                }
            };

            Plotly.newPlot('mesh-plot', data, layout);
            document.getElementById("mesh-output").innerText = `Generated ${coords.length} nodes.`;
        }
    }

    // Viewer Class to handle HTML interactions and manage Mesh and Drawer
    class Viewer {
        constructor() {
            this.cellSizeInput = document.getElementById("cellSize");
            this.meshWidthInput = document.getElementById("meshWidth");
            this.meshHeightInput = document.getElementById("meshHeight");
            this.latticeTypeInput = document.getElementById("latticeType");
            this.lineWidthsInput = document.getElementById("lineWidths");
        }

        initialize() {
            // Bind listeners to HTML inputs
            this.cellSizeInput.addEventListener("input", () => this.updateMesh());
            this.meshWidthInput.addEventListener("input", () => this.updateMesh());
            this.meshHeightInput.addEventListener("input", () => this.updateMesh());
            this.latticeTypeInput.addEventListener("change", () => this.updateMesh());
            this.lineWidthsInput.addEventListener("input", () => this.updateMesh());

            // Generate initial mesh
            this.updateMesh();
        }

        updateMesh() {
            // Get input values
            const cellSize = parseFloat(this.cellSizeInput.value);
            const meshWidth = parseFloat(this.meshWidthInput.value);
            const meshHeight = parseFloat(this.meshHeightInput.value);
            const latticeType = this.latticeTypeInput.value;
            const lineWidths = this.lineWidthsInput.value.split(',').map(Number).filter(w => !isNaN(w) && w > 0);

            // Create Mesh object
            const mesh = new Mesh(cellSize, meshWidth, meshHeight, latticeType);

            // Create Drawer object with variable line widths and plot the mesh
            const drawer = new Drawer(mesh, lineWidths);
            drawer.plot();
        }
    }
</script>
</body>
</html>
