<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contribution Heatmap</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
<div id="heatmap" style="width: 100%; height: 400px;"></div>
<script>
    // Fetch the JSON file dynamically
    fetch('github_user_report.json')  // Use the correct path for the JSON file
        .then(response => response.json())
        .then(data => {
            const newData = {};  // To store the daily commit counts by year

            // Process the JSON data
            data.repositories.forEach(repo => {
                repo.daily_log.forEach(log => {
                    const date = log.date;
                    const year = new Date(date).getFullYear();

                    if (!newData[year]) newData[year] = {};
                    if (!newData[year][date]) newData[year][date] = 0;

                    newData[year][date] += log.commits;
                });
            });

            // Function to process and group commits by month and day
            function getHeatmapData(year) {
                const commitData = newData[year] || {};
                const dates = Object.keys(commitData);

                // Prepare empty array for 7 days (week rows) and 52 weeks (cols)
                const z = Array(7).fill().map(() => Array(52).fill(0));

                dates.forEach(date => {
                    const currentDate = new Date(date);
                    const dayOfWeek = currentDate.getDay();
                    const weekOfYear = Math.floor(currentDate.getDate() / 7) + (currentDate.getMonth() * 4);

                    // Fill the matrix with commit data
                    z[dayOfWeek][weekOfYear] = commitData[date] || 0;
                });

                return z;
            }

            // Generate the heatmap for the latest year
            const latestYear = Math.max(...Object.keys(newData));
            const z = getHeatmapData(latestYear);

            const trace = {
                z: z,
                type: 'heatmap',
                xgap: 2,
                ygap: 2,
                showscale: true,
                colorscale: 'Reds',  // GitHub-like color scheme
            };

            const layout = {
                xaxis: {
                    showticklabels: true,
                    ticks: '',
                    tickmode: 'array',
                    tickvals: [0, 4, 8, 12, 16, 20, 24, 28, 32, 36, 40, 44, 48],
                    ticktext: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    showgrid: false,
                    showline: false,
                    zeroline: false,
                },
                yaxis: {
                    showticklabels: false,
                    ticks: '',
                    showgrid: false,
                    zeroline: false,
                    showline: false,
                },
                margin: {
                    t: 20,
                    r: 20,
                    l: 20,
                    b: 20,
                },
                height: 250,
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',

            };

            Plotly.newPlot('heatmap', [trace], layout);
        })
        .catch(error => console.error('Error fetching JSON:', error));
</script>
</body>
</html>
